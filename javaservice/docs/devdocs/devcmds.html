<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta content="text/html; charset=iso-8859-1" http-equiv="Content-Type">
	<meta content="en" http-equiv="Content-Language">

	<title>JavaService - Technical Commands and Operations</title>

	<meta name="Robots" content="index, follow">

	<link type="text/css" href="../resources/javaservice.css" rel="stylesheet" id="stylesheet">
	<link type="image/x-icon" href="../favicon.ico" rel="icon">
	<link type="image/x-icon" href="../favicon.ico" rel="shortcut icon">
</head>
<body bgcolor="#FFFFFF">

<h2>JavaService - Technical Operations</h2>

<p>
The full set of command and parameters available from JavaService is likely to be of interest
to more technical users, either when integrating Java applications with this utility, or when
investigation further options for an existing usage.
</p>

<h3>Command Summary</h3>
<p>
The commands listed below are self-documented within the application, if invoked from a
Windows command prompt with the <code>JavaService -help</code> command.
</p>

<dl>

<dt>-help</dt>
<dd>(or -?) Lists the commands available from JavaService</dd>

<dt>-version</dt>
<dd>Outputs the built-in version number of the JavaService program</dd>

<dt>-licence</dt>
<dd>(or -license) Outputs the LGPL licence text covering the program</dd>

<dt>-install servicename</dt>
<dd>Installs the named service with specified configuration options</dd>

<dt>-queryconfig servicename</dt>
<dd>Displays confguration details for the installed Java service</dd>

<dt>-status servicename</dt>
<dd>Displays current execution status of the named Java service</dd>

<dt>-uninstall servicename</dt>
<dd>Removes definition of the specified Java service</dd>

</dl>


<h3>Available Operations</h3>

<h4>Service Installation</h4>

<p>
The main command function needed from JavaService is the ability to install a Java application as a Windows system service.
</p>

<p>
From a Windows command prompt, or a suitably defined script file, enter the command:
<br>
<code>JavaService -install</code>
<br>
Followed by the relevant parameters as described below. Ensure that quotation marks are
used around an parameters that contain spaces to avoid run-time failures.
</p>
<ul>
	<li><i>service_name</i> (mandatory) - The name that you want to use 
	  for this service. This is what the service will show up as in the 
	  service control manager.<br>
	  <br>
	</li>
	<li><i>jvm_library</i> (mandatory) - The location of the jvm.dll file 
	  that you want to use as your Java Virtual Machine. For Sun's Java 
	  2 SDK, this is usually {JDK_HOME}\jre\bin\classic\jvm.dll or {JDK_HOME}\jre\bin\hotspot\jvm.dll.<br>
	  <br>
	</li>
	<li><i>jvm_option</i>* (optional) - Optionally specify any necessary 
	  parameters to pass to the JVM upon invocation. These may include 
	  thing such as &quot;-Djava.class.path=&quot; to specify a classpath 
	  or &quot;-Xmx128m&quot; to specify a maximum heap size of 128MB. 
	  Any parameters that you need to use when invoking the java.exe command 
	  tool should be specified here. There is no limit to the number of 
	  parameters specified.<br>
	  <br>
	</li>
	<li>-start <i>start_class</i> (mandatory) - The name of the class 
	  that you wish to use when starting the service. This must be the 
	  fully qualified class name.<br>
	  <br>
	</li>
	<li>-method <i>start_method</i> (optional) - The name of the static 
	  method of the <i>start_class</i> that you wish to call to start 
	  the service. The method must be <span class="textCode">static</span>, 
	  must return type <span class="textCode">void</span>, and must take 
	  a <span class="textCode">String[]</span> as its only parameter. 
	  If this parameter is not specified it defaults to <span class="textCode">main</span>.<br>
	  <br>
	</li>
	<li>-params <i>start_parameter</i>+ (optional) - Any parameters to 
	  pass to the <i>start_method</i> when starting the service. These 
	  will be passed in as the <span class="textCode">String[]</span> 
	  parameter.<br>
	  <br>
	</li>
	<li>-stop <i>stop_class</i> (optional) - The name of the class that 
	  you wish to use when stopping the service. This must be the fully 
	  qualified class name. If no <i>stop_class</i> is specified, the 
	  process containing the Virtual Machine is simply terminated when 
	  the service is stopped.<br>
	  <br>
	</li>
	<li>-method <i>stop_method</i> (optional, but only allowed if a <i>stop_class</i> 
	  was specified) - The name of the static method of the <i>stop_class</i> 
	  that you wish to call to stop the service. The method must be <span class="textCode">static</span>, 
	  must return type <span class="textCode">void</span>, and must take 
	  a <span class="textCode">String[]</span> as its only parameter. 
	  If this parameter is not specified it defaults to <span class="textCode">main</span>.<br>
	  <br>
	</li>
	<li>-params <i>start_parameter</i>+ (optional, but only allowed if 
	  a <i>stop_class</i> was specified) - Any parameters to pass to the 
	  <i>stop_method</i> when stopping the service. These will be passed 
	  in as the <span class="textCode">String[]</span> parameter.<br>
	  <br>
	</li>
	<li>-out <i>out_log_file</i> (optional) - A file into which System.out 
	  will be redirected. If this parameter is not specified, System.out 
	  will not be redirected.<br>
	  <br>
	</li>
	<li>-err<i> err_log_file</i> (optional) - A file into which System.err 
	  will be redirected. If this parameter is not specified, System.err 
	  will not be redirected.<br>
	  <br>
	</li>
	<li>-current<i> current_dir</i> (optional) - A directory to use as 
	  the current working directory for the service. If this parameter 
	  is specified, all relative paths in the service will be relative 
	  to relative to the specified directory.<br>
	  <br>
	</li>
	<li>-path<i> extra_path</i> (optional) - An addition to the path for 
	  the service. The specified path will be appended to the system path 
	  before the service is started. This can be used to specify where 
	  additional DLLs that native libraries are dependent upon can be 
	  found.<br>
	  <br>
	</li>
	<li>-depends<i> other_services</i> (optional) - Another NT service (or multiple services,
	if specified as a comma-separated list) that
	must be running before this particular java service can start. Will cause
	the named service(s) to be started automatically if required when starting
	the java service. Will also stop the java service if a specified service is stopped
	(usually with user confirmation first being requested by Windows NT).<br>
	<br>
	</li>
	<li>-auto <i>or</i> -manual - Optional parameter indicating whether service
	should be run automatically on system startup (default mode), or if it should
	be started on demand using a manual command (i.e. net start service).<br>
	<br>
	</li>
	<li>-shutdown<i> seconds</i> (optional) - Specify the amount of time that
	may be taken during processing of your shutdown/stop method. The value here
	is used as a timeout, so if the method has not completed in this length of time,
	the JVM process will be terminated to allow the service to shutdown completely.<br>
	<br>
	</li>
	<li>-user<i> user_name</i> (optional) - Specify the Windows domain username to be
	used when running the service (also requires that the password parameter is specified).<br>
	Note that this should generally be specified in Windows 2000 Active Directory style (i.e.&nbsp;johndoe@foobar.com)<br>
	<br>
	</li>
	<li>-password<i> password</i> (optional) - Specify the Windows password associated with
	the domain username specified for use when running the service (specify with user parameter).<br>
	<br>
	</li>
	<li>-append <i>or</i> -overwrite - Optional parameter indicating whether output
	and error log files are to be appended to, or overwritten, on each service startup.
	If not specified, the default is to append to existing log files.<br>
	<br>
	</li>
</ul>

<h5>Example Command</h5>
      <p >A simple example might look like the following:</p>
      <blockquote> 
        <p class="mainCode">JavaService.exe -install &quot;My Service&quot; c:\jdk\jre\bin\classic\jvm.dll 
          -Djava.class.path=c:\app\classes.jar -start com.my.ExampleClass -err 
          c:\app\stderr.txt</p>
      </blockquote>
      <p >This would create a service that, when started, would 
        create a JVM from the JDK in c:\jdk setting the classpath to be c:\app\classes.jar.
        It would then call the main method of the com.my.ExampleClass class with 
        a String array of length 0 (no parameters). Anything written to System.err 
        would be redirected into the file c:\app\stderr.txt.<br>
      </p>


<h5>Technical Tip</h5>
<p>
Especially when running more than one Java application as a service, you may find it useful to
copy and rename the program file before each use to indicate the application name concerned.
</p>
<p>
In this way, the Windows Task Manager will show the relevant program name in its list of processes,
where <code>AbcService.exe</code> and <code>XyzService.exe</code>
would be clearer than two entries for <code>JavaService.exe</code> if renaming is not used.
</p>


<h4>Starting a Service</h4>

<h4>Stopping a Service</h4>


<h4>Removing a Service</h4>
      <p class="mainBold"><a name="UnInstalling"></a>UnInstalling</p>
      <ol >
        <li>Start a command prompt and change to the directory where the JavaService.exe 
          is located.</li>
        <li>Type <span class="textCode">'JavaService.exe -uninstall'</span> followed 
          by the name of the service.</li>
      </ol>

<h4>Version Number Query</h4>

      <p >There are two ways to determine the version number of this program.
	  <br>First:</p>
      <ol >
        <li>Start a command prompt and change to the directory where the JavaService.exe 
          is located.</li>
        <li>Type <span class="textCode">'JavaService.exe -version'</span> 
          and the program will display version and copyright information.</li>
      </ol>
      <p >Alternatively:</p>
      <ol >
	  <li>Locate and select the file <em>JavaService.exe</em> in Windows Explorer.</li>
      <li>View the properties of this executable file by either pressing <em>Alt+Enter</em>
		  or by using the right-click menu and selecting <em>Properties</em> from the list.</li>
	 <li>The version number and copyright information for the program can then be viewed from the property tabs
		  displayed by Windows.</li>
      </ol>

<h3>Registry Settings</h3>

      <p >JavaService stores the configuration information for 
        installed services in the registry. The location is </p>
      <blockquote> 
        <p >HKEY_LOCAL_MACHINE\ SYSTEM\ CurrentControlSet\ Services\ 
          {SERVICE_NAME}\ Parameters</p>
      </blockquote>
      <p >The following keys are used and may be changed after 
        service installation to modify the behavior of the service.</p>
      <blockquote> 
        <p >Current Directory - The current working directory 
          for the service.</p>
        <p >JVM Library - The location of the jvm.dll library 
          to use to create the Java Virtual Machine.</p>
        <p >JVM Option Count - The number of option to pass 
          to the JVM when creating it.</p>
        <p >JVM Option Number <i>n</i> - An option to pass to 
          the JVM. <i>n</i> ranges from 0 to &quot;JVM Option Count&quot; - 1.</p>
        <p >Path - Extra path information that will be appended 
          to the system path before the service is started.</p>
        <p >Start Class - The class to use to start the service.</p>
        <p >Start Method - The static method to call on the 
          &quot;Start Class&quot; to start the service.</p>
        <p >Start Param Count - The number of parameters to 
          pass to the &quot;Start Method&quot; to start the service.</p>
        <p >Start Param Number n - A parameter to pass to the 
          &quot;Start Method&quot; to start the service. n ranges from 0 to &quot;Start 
          Param Count&quot; - 1.</p>
        <p >Stop Class - The class to use to stop the service. 
          If this key is absent, the process containing the JVM will simply be 
          terminated when the service is stopped.</p>
        <p >Stop Method - The static method to call on the &quot;Stop 
          Class&quot; to stop the service.</p>
        <p >Stop Param Count - The number of parameters to pass 
          to the &quot;Stop Method&quot; to stop the service.</p>
        <p >Stop Param Number n - A parameter to pass to the 
          &quot;Stop Method&quot; to stop the service. n ranges from 0 to &quot;Stop 
          Param Count&quot; - 1.</p>
        <p >System.err File - A file into which System.err will 
          be redirected. If this key is absent, System.err will not be redirected.</p>
        <p >System.out File - A file into which System.out will 
          be redirected. If this key is absent, System.out will not be redirected.</p>
        <p >Shutdown Timeout - The number of milliseconds to allow for
		the Java Stop method to complete, before timeout and JVM forced termination.</p>
      </blockquote>

<h3>Event Log Messages</h3>

      <p >JavaService logs both informational events and errors 
        into the Application portion of the NT Event Log. Informational messages 
        include a message when the service is started and one when it is stopped. 
        Error messages may be logged because of a configuration problem or other 
        system error. If you are having trouble getting JavaService to run your 
        application, you should first check the Application portion of the Event 
        Log to see if any errors were reported. Additionally you can check the 
        redirected System.err file, as any Java exceptions will be written there 
        by the Virtual Machine.</p>

<p>&nbsp;</p>	  

</body>
</html>
